<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
	$(function () {

		$('#search-specific-requirement').click(searchSpecificRequirement);

	});

	
	function searchSpecificRequirement(){
    google.script.run.openSearchRequirementDialog()
  }

	function addTreeListener() {
		var toggler = document.getElementsByClassName("caret");
		var i;
		for (i = 0; i < toggler.length; i++) {
			toggler[i].addEventListener("click", function () {
				this.parentElement.querySelector(".nested").classList.toggle("active");
				this.classList.toggle("caret-down");

			});
		}

		var valis = document.getElementsByClassName("vali");
		for (i = 0; i < valis.length; i++) {
			valis[i].addEventListener("click", function () {
				google.script.run
					.withFailureHandler(errorMessage)
					.insertVali(this.id);
			});
		}

		var specifications = document.getElementsByClassName("addSpecification");
		for (i = 0; i < specifications.length; i++) {
			specifications[i].addEventListener("click", function () {
				google.script.run
					.withFailureHandler(errorMessage)
					.insertSpecification_withSection(this.id);
			});
		}

		var requirements = document.getElementsByClassName("requirement");
		for (i = 0; i < requirements.length; i++) {
			requirements[i].addEventListener("click", function () {
				google.script.run
					.withFailureHandler(errorMessage)
					.insertRequirement(this.id);
			});
		}

		function errorMessage(error) {
			//Logger.log(error);
		}

	}

	function updateTree(id, name) {
		$('#projectTree').html("Loading tree " + name + "....");
		google.script.run.withSuccessHandler(
			function (newHtml) {
				$('#projectTree').html(newHtml);
				addTreeListener();
			}
		)
			.withFailureHandler(
				function (error) {
					$('#projectTree').html("Failed to load project tree. Please try again, if the problem persist contact support@valispace.com");
				})
			.getProjectTree(id);
	}

	//	function updateRequirementTree(id, name){
	//	  $('#requirementTree').html("Loading requirements for " + name + "....");
	//	  google.script.run
	//		.withSuccessHandler(
	//		  function(newHtml){
	//			$('#requirementTree').html(newHtml);
	//			addTreeListener();
	//		  }
	//		)
	//		.withFailureHandler(
	//		  function(error){
	//			$('#requirementTree').html("Failed to load requirement tree. Please try again, if the problem persist contact support@valispace.com");
	//		  }
	//		)
	//		.getRequirementTree(id);
	//	
	//	}

	function updateAllTrees(projectId, projectName) {
		$('#projectTree').html("Loading components for " + name + "....");
		$('#requirementTree').html("Loading requirements for " + name + "....");
		google.script.run
			.withSuccessHandler()
			.withFailureHandler(
				function (error) {
					$('#requirementTree').html("Failed to load requirements. Please try again, if the problem persist contact support@valispace.com");
				})
			.getRequirementTree(projectId);

	}



</script>