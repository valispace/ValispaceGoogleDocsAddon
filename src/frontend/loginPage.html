<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    
    <?!=HtmlService.createHtmlOutputFromFile('frontend/sidebar.css').getContent()?>
    <?!=HtmlService.createHtmlOutputFromFile('frontend/loginPage.css').getContent()?>
    
    
  </head>
  <body>
    <div id='loginForm'>
    <form>
        <div class="input-label">
          <label for="deployment">Deployment Url<br></label>
        </div> 
      <div class="input-field">
        <input type="text" id="deployment" name="deployment" value="https://demo.valispace.com">
      </div>
      
      <div class="input-label">
        <label  for="username">Username<br></label>
      </div> 
      <div class="input-field">
        <input type="text" id="username" name="username">
      </div>
  
      <div class="input-label">
        <label for="pass">Password<br></label>
      </div>
      <div class="input-field">
        <input type="password" id="pass" name="password">
      </div>
      <div class="buttons-container">
        <input type="submit" value="Connect" class="valiButton" onclick="connect()" >
        <input type="button" value="Close" class="valiButton" onclick="closeIt()" >
      </div>  
      <div id="output"></div>
    </form>
  </div>


    <span>
      </span>
      <p class="connectionStatus" id="connectionStatus"></p>
      <!-- TODO: Change Status to Checking connection automatically (or default value?) -->

 <!-- TODO: Pass to CSS -->
  <style>
  canvas {
    display: block;
    vertical-align: bottom;
  }
  </style>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
    <script>
      function connect(){
        var div = document.getElementById('connectionStatus');
        div.innerHTML = "Connecting...";         
        google.script.run
          .withSuccessHandler(goToMainPage)
          .withFailureHandler(errorMessage)
          .valispaceAskToken($('#deployment').val(), $('#username').val(), $('#pass').val());
      };
      
      function errorMessage(error) {
        var div = document.getElementById('output');
        div.innerHTML = "Error Connecting.";
      }
      
      function goToMainPage(){
        google.script.run.goToMainPage() 
      };
      
    </script>
    
    </body>
</html>