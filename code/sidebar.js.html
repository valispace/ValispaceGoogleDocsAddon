<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
      /**
       * On document load, assign click handlers to each button and try to load the
       * user's origin and destination language preferences if previously set.
       */
      $(function() {
        $('#valispace-connect').click(connectValispaceScript);
        $('#valispace-disconnect').click(disconnectValispaceScript);
        $('#valispace-options').click(OptionsScript);

        $('#update-all-valies').click(updateAllValiesScript);
        $('#update-all-requirements').click(updateAllRequirementsScript);

        $('#update-workspaces').click(updateWorkspacesOptionsScript);
        $('#update-projects').click(updateProjectOptionsScript);
        
        
        
        $('#update-tree').click(updateSelectedProjectScript);
        
        
        $('#options-workspaces').change(updateSelectedWorkspaceScript);
        $('#options-projects').change(updateSelectedProjectScript);
        $('#connectionStatus').html("Not Connected");
        
//        google.script.run
//          .withSuccessHandler(function(connected){
//              if(connected){
//                 $('#connectionStatus').html("Connected");
//                 updateWorkspacesOptionsScript();
//                 //updateProjectOptionsScript();
//               } else {
//                 $('#connectionStatus').html("Not connected");
//               }
//               
//            }
//          )
//          .withFailureHandler(function(error){
//              alert(error);
//            }
//          )
//          .checkValispaceconnection();
          
          
        
//        google.script.run
//          .withUserObject(this)
//          .withSuccessHandler(updateProjectOptionsScript)
//          .get_projects()
          
      });
      
      function updateWorkspacesOptionsScript(){
        google.script.run
          .withSuccessHandler(function(options){
            var insertedHTML = "";
            var i;
            for (i = 0 ; i < options.length ; i++){
              insertedHTML += "<option "
              insertedHTML += 'value="' + options[i].id + '">';
              insertedHTML += options[i].name;
              insertedHTML += "</option>"
            }
            $('#options-workspaces').html(insertedHTML);
            })
          .get_workspaces();
      }
      
      function updateProjectOptionsScript(workspaceID){
        google.script.run
          .withSuccessHandler(function(options){
            var insertedHTML = "";
            var i;
            for (i = 0 ; i < options.length ; i++){
              insertedHTML += "<option "
              insertedHTML += 'value="' + options[i].id + '">';
              insertedHTML += options[i].name;
              insertedHTML += "</option>"
            }
            $('#options-projects').html(insertedHTML);
            })
          .get_projects(workspaceID);
      }

      function updateSelectedWorkspaceScript(){
        var workspaceID=$("#options-workspaces").val();
        var name= $("#options-workspaces option:selected").text();
        updateProjectOptionsScript(workspaceID);
      }
      
      function updateSelectedProjectScript(){
        var id=$("#options-projects").val();
        var name= $( "#options-projects option:selected").text();
        updateAllTrees(id, name);
        
      }
      
      function insertNewValiScript() {
        google.script.run
            .withUserObject(this)
            .insertVali();
      }
      
      function updateAllRequirementsScript(){
        $('#updating-requirements-status').html("Updating...");
        google.script.run
            .withUserObject(this)
            .withSuccessHandler(
              function(){
                $('#updating-requirements-status').html("Done");
              }
            )
            .withFailureHandler(
              function(error){
                $('#updating-requirements-status').html("Update failed");
                alert(error);
              }
            )
            .updateAllRequirements();
      }
      
      function updateAllValiesScript() {
        $('#updating-valies-status').html("Updating...");
        google.script.run
            .withUserObject(this)
            .withSuccessHandler(
              function(){
                $('#updating-valies-status').html("Done");
              }
            )
            .withFailureHandler(
              function(error){
                $('#updating-valies-status').html("Update failed");
                alert(error);
              }
            )
            .updateValies();
      }
      function connectValispaceScript(){
          google.script.run
            .withUserObject(this)
            .withSuccessHandler(
              function(res){
                if(res){
                  $('#connectionStatus').html("Connected");
                  updateWorkspacesOptionsScript();
                } else {
                  alert("connection failed");
                  $('#connectionStatus').html("Not connected");
                }
              }
            )
            .withFailureHandler(
              function(error){
                alert(error);
              }
            )
            .connectValispace();
           
      }
      
      function disconnectValispaceScript(){
      
      }
      
      function OptionsScript(){
      google.script.run.withUserObject(this).openOptionDialog();
      }
      
     

 
      function showError(msg, element) {
        var div = $('<div id="error" class="error">' + msg + '</div>');
        $(element).after(div);
      }
</script>